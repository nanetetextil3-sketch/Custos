<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPV - Calculadora de Preço de Venda</title>
  <style>
/* Estilos Básicos */
.container {
    max-width: 450px; 
    margin: 20px auto;
    padding: 15px;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-family: Arial, sans-serif;
}
.form-group {
    margin-bottom: 15px;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}
.form-group input {
    width: 100%;
    padding: 8px;
    box-sizing: border-box;
}
.markup-container {
    display: flex;
}
.markup-container input {
    flex-grow: 1;
}
.markup-container button {
    margin-left: 10px;
    padding: 8px 15px;
    white-space: nowrap;
}
button {
    padding: 10px 20px;
    margin-top: 10px;
    cursor: pointer;
    width: 100%;
}

/* Estilo da Tabela de Resultados */
#tabela-wrapper {
    margin-top: 20px;
}
#tabela {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9em;
}
#tabela th, #tabela td {
    border: 1px solid #ddd;
    padding: 10px 5px;
    text-align: center;
}
#limpar {
    margin-top: 20px;
    background-color: #f44336;
    color: white;
    border: none;
}

</style>
</head>
<body>
    <div class="container">
        <h2>CPV - Calculadora de Preço de Venda</h2>
        
        <div class="form-group">
            <label for="preco">Preço de Venda (R$)</label>
            <input type="number" id="preco" placeholder="Digite o preço de venda">
        </div>

        <div class="form-group">
            <label for="custo">Custo do Produto (R$)</label>
            <input type="number" id="custo" placeholder="Digite o custo">
        </div>

        <div class="form-group">
            <label for="comissao">Comissão (%)</label>
            <input type="number" id="comissao" value="5">
        </div>

        <div class="form-group">
            <label for="frete">Frete (%)</label>
            <input type="number" id="frete" value="3">
        </div>

        <div class="form-group">
            <label for="markup">Markup (%) sobre o Custo</label>
            <div class="markup-container">
                <input type="password" id="markup" value="7" placeholder="7" readonly>
                <button type="button" onclick="desbloquearMarkup()">Visualizar</button>
            </div>
        </div>
        
        <button onclick="calcular()">Calcular</button>
        
        <div id="tabela-wrapper" style="display:none;"> 
            <table id="tabela">
                <thead>
                    <tr>
                        <th>Lucro Líquido (R$)</th>
                        <th>Margem Líquida (%)</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <button id="limpar" onclick="limparHistorico()">Limpar Histórico</button>
    </div>

<script>
let produtosWP = []; 

// RESTAURADO: A função de visualização com senha
function desbloquearMarkup() {
    const senha = prompt("Digite a senha para visualizar o Markup:");
    const markup = document.getElementById("markup");
    if (senha === "ABCD") {
        markup.type = "number";
        markup.removeAttribute("readonly");
    } else {
        alert("Senha incorreta!");
    }
}

function calcular() {
    // 1. Coletar e validar os dados de entrada
    const preco = parseFloat(document.getElementById("preco").value) || 0;
    const custo = parseFloat(document.getElementById("custo").value) || 0;
    const comissaoPerc = parseFloat(document.getElementById("comissao").value) || 0;
    const fretePerc = parseFloat(document.getElementById("frete").value) || 0;
    
    // Markup (percentual sobre o Custo)
    const markupPercSobreCusto = parseFloat(document.getElementById("markup").value) || 0; 
    
    // Validação básica
    if (preco <= 0 || custo <= 0) {
        alert("Digite um Preço de Venda e um Custo válidos para o cálculo!");
        return;
    }

    // ----------------------------------------------------
    // CÁLCULO DOS CUSTOS
    // ----------------------------------------------------
    
    // 1. Custo Fixo do Markup (R$) - Markup aplicado sobre o CUSTO do produto
    const valorMarkupR = custo * (markupPercSobreCusto / 100);
    
    // 2. Despesas Variáveis em R$ (aplicadas sobre o Preço de Venda)
    const valorComissao = preco * (comissaoPerc / 100);
    const valorFrete = preco * (fretePerc / 100);
    
    // ----------------------------------------------------
    // CÁLCULO DE RENTABILIDADE
    // ----------------------------------------------------
    
    // Lucro Líquido (R$) = Preço - Custo Produto - Custo Markup - Comissão - Frete
    const lucroLiquidoR = preco - custo - valorMarkupR - valorComissao - valorFrete;

    // Margem Líquida (%) = (Lucro Líquido / Preço) * 100
    const margemLiquidaPerc = (lucroLiquidoR / preco) * 100;

    // ----------------------------------------------------
    // 3. Atualizar a tabela de resultados (histórico)
    // ----------------------------------------------------
    
    const tabela = document.getElementById("tabela");
    const tbody = tabela.querySelector("tbody");

    // Exibe o wrapper e a tabela
    document.getElementById("tabela-wrapper").style.display = "block";
    tabela.style.display = "table";

    const linha = document.createElement("tr");
    linha.innerHTML = `
        <td>R$ ${lucroLiquidoR.toFixed(2)}</td>
        <td>${margemLiquidaPerc.toFixed(2)}%</td>
    `;

    tbody.appendChild(linha);
}

function limparHistorico() {
    const tabela = document.getElementById("tabela");
    const tbody = tabela.querySelector("tbody");
    tbody.innerHTML = "";
    document.getElementById("tabela-wrapper").style.display = "none";
    tabela.style.display = "none";
}
</script>
</body>
</html>

